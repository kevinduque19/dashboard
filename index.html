<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
    :root {
        --bg-light: #d9e4ef;
        --bg-dark: #050814;
        --panel-light: rgba(20, 60, 120, 0.9);
        --panel-dark: rgba(8, 20, 60, 0.95);
        --text-main: #ffffff;
    }

    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
        background: var(--bg-light);
        color: var(--text-main);
        transition: background 0.6s ease;
    }

    body.theme-light {
        background: var(--bg-light);
    }

    body.theme-dark {
        background: var(--bg-dark);
    }

    /* ---- TOP BAR (Time + Weather + Forecast) ---- */
    #top {
        width: 100%;
        background: url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1350&q=80") center/cover no-repeat;
        padding: 24px 32px;
        box-sizing: border-box;
        color: white;
        text-shadow: 0 1px 6px rgba(0,0,0,0.5);
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 24px;
    }

    #topLeft {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #clock {
        font-size: 4em;
        font-weight: 300;
        line-height: 1;
    }

    #date {
        font-size: 1.5em;
        margin-top: -8px;
    }

    #topRight {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }

    #weatherBox {
        text-align: right;
    }

    #weatherTemp {
        font-size: 2.4em;
        font-weight: 600;
    }

    #weatherDesc {
        font-size: 0.9em;
        text-transform: capitalize;
    }

    #weatherIcon {
        margin-bottom: 4px;
    }

    /* animated main icon */
    #weatherIcon svg {
        width: 60px;
        height: 60px;
    }
    .sun-core {
        fill: #ffcc33;
    }
    .sun-rays {
        stroke: #ffcc33;
        stroke-width: 2;
        stroke-linecap: round;
        animation: spinSun 18s linear infinite;
        transform-origin: 32px 32px;
    }
    @keyframes spinSun {
        from { transform: rotate(0deg); }
        to   { transform: rotate(360deg); }
    }

    /* Forecast sidebar */
    #forecastSidebar {
        background: rgba(0,0,0,0.2);
        padding: 8px 10px;
        border-radius: 10px;
        min-width: 150px;
        backdrop-filter: blur(4px);
        font-size: 0.85em;
    }

    .forecast-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
        margin-bottom: 4px;
    }

    .forecast-day {
        font-weight: 600;
    }

    .forecast-temp {
        opacity: 0.9;
    }

    .mini-icon {
        width: 22px;
        text-align: center;
        display: inline-block;
        margin-right: 4px;
        animation: floatMini 3s ease-in-out infinite;
    }
    @keyframes floatMini {
        0%,100% { transform: translateY(0); opacity: 0.9; }
        50%     { transform: translateY(-2px); opacity: 1; }
    }

    /* ---- MAIN GRID ---- */
    #main {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        padding: 15px;
        box-sizing: border-box;
    }

    .panel {
        background: var(--panel-light);
        backdrop-filter: blur(8px);
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    body.theme-dark .panel {
        background: var(--panel-dark);
    }

    .panel h2 {
        font-size: 1.4em;
        margin: 0 0 10px 0;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255,255,255,0.25);
        font-weight: 500;
    }

    .panel-content {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
    }

    iframe {
        border: none;
        width: 100%;
        flex: 1;
        border-radius: 8px;
        background: #0a162c;
    }

    body.theme-dark iframe {
        background: #020714;
    }
</style>
</head>

<body class="theme-light">

<!-- ===================== -->
<!-- TOP: CLOCK + WEATHER  -->
<!-- ===================== -->

<div id="top">
    <div id="topLeft">
        <div id="clock">--:--</div>
        <div id="date">Loading date‚Ä¶</div>
    </div>

    <div id="topRight">
        <div id="weatherBox">
            <div id="weatherIcon"></div>
            <div id="weatherTemp">--¬∞F</div>
            <div id="weatherDesc"></div>
        </div>

        <div id="forecastSidebar">
            <div style="font-weight:700;margin-bottom:4px;">Forecast</div>
            <div id="forecastRows">
                <div class="forecast-row"><span class="forecast-day">---</span></div>
            </div>
        </div>
    </div>
</div>


<!-- ===================== -->
<!--   MAIN 2-COLUMN GRID  -->
<!-- ===================== -->

<div id="main">

    <!-- LEFT COLUMN: TRANSIT -->
    <div class="panel">
        <h2>Transit (Bus / PATH / Light Rail)</h2>
        <div class="panel-content">
            <iframe id="bus" src="https://dv.njtransit.com/#/bus/trips?stop=21352"></iframe>
            <iframe id="path" src="https://citymapper.com/nyc/path/stations/exchange-place-path"></iframe>
            <iframe id="lrt" src="https://dv.njtransit.com/#/lightrail/trips?route=HBLR&stop=TONELAVE"></iframe>
        </div>
    </div>

    <!-- RIGHT COLUMN: GOOGLE CALENDAR -->
    <div class="panel">
        <h2>Upcoming Events</h2>
        <div class="panel-content">
            <iframe
                style="width:100%; height:100%; border:none; border-radius:8px;"
                src="https://calendar.google.com/calendar/embed?src=r1174onu9evdmkccn0u9e52snjeu5f7l%40import.calendar.google.com&ctz=America%2FNew_York&mode=AGENDA&showTitle=0&showNav=0&showTabs=0&showCalendars=0&showPrint=0&bgcolor=%23143C78">
            </iframe>
        </div>
    </div>

</div>


<!-- ===================== -->
<!-- JAVASCRIPT LOGIC      -->
<!-- ===================== -->

<script>
const API_KEY = "c7ca510710b08b51215791ed290d958a";
const LAT = 40.78467;
const LON = -74.03010;

/* THEME: LIGHT BY DAY, DARK BY NIGHT */
function applyTheme() {
    const hour = new Date().getHours(); // local time
    const body = document.body;
    body.classList.remove("theme-light", "theme-dark");
    if (hour >= 7 && hour < 19) {
        body.classList.add("theme-light");
    } else {
        body.classList.add("theme-dark");
    }
}
applyTheme();
setInterval(applyTheme, 10 * 60 * 1000); // re-check every 10 min

/* CLOCK */
function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText =
        now.toLocaleTimeString("en-US", {hour:"numeric", minute:"2-digit"});

    document.getElementById("date").innerText =
        now.toLocaleDateString("en-US", {
            weekday:"long",
            month:"long",
            day:"numeric"
        });
}
setInterval(updateClock, 1000);
updateClock();

/* WEATHER + FORECAST */
function iconSvg(main) {
    // Simple animated sun / cloud / rain variants
    main = (main || "").toLowerCase();
    if (main.includes("rain") || main.includes("drizzle")) {
        return `
        <svg viewBox="0 0 64 64">
          <defs>
            <linearGradient id="rainGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#8ec5fc"/>
              <stop offset="100%" stop-color="#3b82f6"/>
            </linearGradient>
          </defs>
          <g>
            <ellipse cx="26" cy="28" rx="16" ry="10" fill="#e5e7eb"/>
            <ellipse cx="40" cy="30" rx="14" ry="9" fill="#d1d5db"/>
            <line x1="22" y1="38" x2="18" y2="50" stroke="url(#rainGrad)" stroke-width="3" stroke-linecap="round">
              <animate attributeName="y1" values="38;42;38" dur="1.2s" repeatCount="indefinite"/>
              <animate attributeName="y2" values="50;54;50" dur="1.2s" repeatCount="indefinite"/>
            </line>
            <line x1="32" y1="38" x2="28" y2="50" stroke="url(#rainGrad)" stroke-width="3" stroke-linecap="round">
              <animate attributeName="y1" values="38;43;38" dur="1.3s" repeatCount="indefinite"/>
              <animate attributeName="y2" values="50;55;50" dur="1.3s" repeatCount="indefinite"/>
            </line>
          </g>
        </svg>`;
    }
    if (main.includes("cloud")) {
        return `
        <svg viewBox="0 0 64 64">
          <g>
            <ellipse cx="26" cy="30" rx="16" ry="10" fill="#e5e7eb">
              <animate attributeName="cx" values="24;28;24" dur="4s" repeatCount="indefinite"/>
            </ellipse>
            <ellipse cx="40" cy="32" rx="14" ry="9" fill="#d1d5db">
              <animate attributeName="cx" values="38;42;38" dur="5s" repeatCount="indefinite"/>
            </ellipse>
          </g>
        </svg>`;
    }
    if (main.includes("snow")) {
        return `
        <svg viewBox="0 0 64 64">
          <g stroke="#e5f0ff" stroke-width="2" stroke-linecap="round">
            <circle cx="24" cy="24" r="2" fill="#e5f0ff">
              <animate attributeName="cy" values="18;30;18" dur="2s" repeatCount="indefinite"/>
            </circle>
            <circle cx="36" cy="28" r="2" fill="#e5f0ff">
              <animate attributeName="cy" values="20;34;20" dur="2.3s" repeatCount="indefinite"/>
            </circle>
          </g>
        </svg>`;
    }
    // default: sun
    return `
    <svg viewBox="0 0 64 64">
      <circle class="sun-core" cx="32" cy="32" r="12"/>
      <g class="sun-rays">
        <line x1="32" y1="8" x2="32" y2="0"/>
        <line x1="32" y1="64" x2="32" y2="56"/>
        <line x1="8" y1="32" x2="0" y2="32"/>
        <line x1="64" y1="32" x2="56" y2="32"/>
        <line x1="12" y1="12" x2="6" y2="6"/>
        <line x1="52" y1="52" x2="58" y2="58"/>
        <line x1="12" y1="52" x2="6" y2="58"/>
        <line x1="52" y1="12" x2="58" y2="6"/>
      </g>
    </svg>`;
}

function miniIcon(main) {
    main = (main || "").toLowerCase();
    if (main.includes("rain") || main.includes("drizzle")) return "üåß";
    if (main.includes("snow")) return "‚ùÑÔ∏è";
    if (main.includes("storm")) return "‚õà";
    if (main.includes("cloud")) return "‚òÅÔ∏è";
    if (main.includes("mist") || main.includes("fog")) return "üå´";
    return "‚òÄÔ∏è";
}

async function loadWeatherAndForecast() {
    try {
        const currentUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&units=imperial&appid=${API_KEY}`;
        const forecastUrl = `https://api.openweathermap.org/data/3.0/onecall?lat=${LAT}&lon=${LON}&exclude=minutely,hourly,alerts&units=imperial&appid=${API_KEY}`;

        const [currentRes, forecastRes] = await Promise.all([
            fetch(currentUrl),
            fetch(forecastUrl)
        ]);

        const current = await currentRes.json();
        const forecast = await forecastRes.json();

        // current
        const temp = Math.round(current.main.temp);
        const desc = current.weather[0].description;
        const main = current.weather[0].main;

        document.getElementById("weatherTemp").innerText = `${temp}¬∞F`;
        document.getElementById("weatherDesc").innerText = desc;
        document.getElementById("weatherIcon").innerHTML = iconSvg(main);

        // forecast: next 5 days (skip today, start from index 1)
     // Make sure daily exists
if (!forecast.daily || !Array.isArray(forecast.daily)) {
    console.log("‚ö†Ô∏è No daily forecast returned:", forecast);
    document.getElementById("forecastRows").innerHTML = `
        <div class="forecast-row">
            <span style="opacity:0.7;">No forecast available</span>
        </div>`;
    return;
}

// Extract next 5 days (skip today)
const rows = forecast.daily.slice(1, 6).map(d => {
    const date = new Date(d.dt * 1000);
    return {
        day: date.toLocaleDateString("en-US", { weekday: "short" }),
        hi: Math.round(d.temp.max),
        lo: Math.round(d.temp.min),
        icon: miniIcon(d.weather[0].main)
    };
});

// Render forecast rows
document.getElementById("forecastRows").innerHTML = rows.map(r => `
    <div class="forecast-row">
        <span class="forecast-day">${r.day}</span>
        <span class="mini-icon">${r.icon}</span>
        <span class="forecast-temp">${r.hi}¬∞ / ${r.lo}¬∞</span>
    </div>
`).join("");

        const container = document.getElementById("forecastRows");
        container.innerHTML = rows.map(r => `
            <div class="forecast-row">
                <span class="forecast-day">${r.day}</span>
                <span class="mini-icon">${r.icon}</span>
                <span class="forecast-temp">${r.hi}¬∞ / ${r.lo}¬∞</span>
            </div>
        `).join("");

    } catch (err) {
        console.log("Weather/forecast error:", err);
    }
}
loadWeatherAndForecast();
setInterval(loadWeatherAndForecast, 10 * 60 * 1000); // every 10 min

/* REFRESH TRANSIT IFRAMES */
setInterval(() => bus.contentWindow.location.reload(), 60000);
setInterval(() => path.contentWindow.location.reload(), 120000);
setInterval(() => lrt.contentWindow.location.reload(), 300000);

</script>

</body>
</html>
