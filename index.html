<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
/* Smooth fade-in for all content updates */
.fade-in {
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.5s ease, transform 0.5s ease;
}
.fade-in.show {
    opacity: 1;
    transform: translateY(0);
}

/* Panels fade-in on load */
.panel {
    opacity: 0;
    animation: panelFade 1s ease forwards;
}
@keyframes panelFade {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* Weather icon soft fade */
#weatherIcon svg {
    opacity: 0;
    animation: fadeWeatherIcon 0.6s ease forwards;
}
@keyframes fadeWeatherIcon {
    from { opacity: 0; transform: scale(0.95); }
    to   { opacity: 1; transform: scale(1); }
}

    :root {
        --bg-light: #d9e4ef;
        --bg-dark: #050814;
        --panel-light: rgba(20, 60, 120, 0.9);
        --panel-dark: rgba(8, 20, 60, 0.95);
        --text-main: #ffffff;
    }

    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial;
        background: var(--bg-light);
        color: var(--text-main);
        transition: background 0.6s ease;
    }

    body.theme-light {
        background: var(--bg-light);
    }

    body.theme-dark {
        background: var(--bg-dark);
    }

    /* ---- TOP BAR ---- */
    #top {
        width: 100%;
        background: url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1350&q=80") center/cover no-repeat;
        padding: 24px 32px;
        box-sizing: border-box;
        color: white;
        text-shadow: 0 1px 6px rgba(0,0,0,0.5);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    #clock {
        font-size: 4em;
        font-weight: 300;
        line-height: 1;
    }

    #date {
        font-size: 1.5em;
        margin-top: -8px;
    }

    #topRight {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }

    #weatherTemp {
        font-size: 2.4em;
        font-weight: 600;
    }

    #weatherDesc {
        font-size: 0.9em;
        text-transform: capitalize;
    }

    /* animated weather icon */
    #weatherIcon svg {
        width: 60px;
        height: 60px;
    }
    .sun-core {
        fill: #ffcc33;
    }
    .sun-rays {
        stroke: #ffcc33;
        stroke-width: 2;
        stroke-linecap: round;
        animation: spinSun 18s linear infinite;
        transform-origin: 32px 32px;
    }
    @keyframes spinSun {
        from { transform: rotate(0deg); }
        to   { transform: rotate(360deg); }
    }

    /* Forecast sidebar */
    #forecastSidebar {
        background: rgba(0,0,0,0.2);
        padding: 8px 10px;
        border-radius: 10px;
        min-width: 150px;
        backdrop-filter: blur(4px);
        font-size: 0.85em;
    }

    .forecast-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        align-items: center;
    }

    .forecast-day {
        font-weight: 600;
    }

    .mini-icon {
        animation: floatMini 3s ease-in-out infinite;
    }

    @keyframes floatMini {
        0%,100% { transform: translateY(0); }
        50%     { transform: translateY(-2px); }
    }

    #main {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        padding: 15px;
    }

    .panel {
        background: var(--panel-light);
        backdrop-filter: blur(8px);
        border-radius: 12px;
        padding: 15px;
        height: 80vh;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        display: flex;
        flex-direction: column;
    }

    body.theme-dark .panel {
        background: var(--panel-dark);
    }

    .panel h2 {
        margin: 0 0 10px;
        border-bottom: 1px solid rgba(255,255,255,0.25);
        padding-bottom: 8px;
    }

    iframe {
        border: none;
        width: 100%;
        flex: 1;
        border-radius: 8px;
    }
</style>
</head>

<body class="theme-light">

<!-- TOP BAR (Clock + Weather + Forecast) -->
<div id="top">
    <div>
        <div id="clock">--:--</div>
        <div id="date">Loading dateâ€¦</div>
    </div>

    <div id="topRight">
        <div id="weatherBox">
            <div id="weatherIcon"></div>
            <div id="weatherTemp">--Â°F</div>
            <div id="weatherDesc"></div>
        </div>

        <div id="forecastSidebar">
            <div style="font-weight:700;margin-bottom:4px;">Forecast</div>
            <div id="forecastRows">
                <div class="forecast-row"><span>---</span></div>
            </div>
        </div>
    </div>
</div>

<div id="main">

    <div class="panel">
        <h2>Transit (Bus / PATH / Light Rail)</h2>
        <iframe id="bus" src="https://dv.njtransit.com/#/bus/trips?stop=21352"></iframe>
        <iframe id="path" src="https://citymapper.com/nyc/path/stations/exchange-place-path"></iframe>
        <iframe id="lrt" src="https://dv.njtransit.com/#/lightrail/trips?route=HBLR&stop=TONELAVE"></iframe>
    </div>

    <div class="panel">
        <h2>Upcoming Events</h2>
        <iframe src="https://calendar.google.com/calendar/embed?src=r1174onu9evdmkccn0u9e52snjeu5f7l%40import.calendar.google.com&ctz=America%2FNew_York&mode=AGENDA&showTitle=0&showNav=0&showTabs=0&showCalendars=0&showPrint=0&bgcolor=%23143C78"></iframe>
    </div>

</div>

<script>
/* ========================================================= */
/* THEME */
/* ========================================================= */
function applyTheme() {
    const hour = new Date().getHours();
    document.body.className = (hour >= 7 && hour < 19) ? "theme-light" : "theme-dark";
}
applyTheme();
setInterval(applyTheme, 600000);

/* ========================================================= */
/* CLOCK */
/* ========================================================= */
function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText =
        now.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
    document.getElementById("date").innerText =
        now.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });
}
setInterval(updateClock, 1000);
updateClock();

/* ========================================================= */
/* WEATHER (Open-Meteo FREE API) */
/* ========================================================= */
const LAT = 40.78467;
const LON = -74.03010;

function iconSvg(main) {
    main = main.toLowerCase();

    if (main.includes("cloud")) {
        return `<svg viewBox="0 0 64 64">
            <ellipse cx="30" cy="32" rx="20" ry="12" fill="#d1d5db"/>
        </svg>`;
    }
    if (main.includes("rain")) {
        return `<svg viewBox="0 0 64 64">
            <ellipse cx="30" cy="28" rx="18" ry="10" fill="#d1d5db"/>
            <line x1="24" y1="40" x2="24" y2="52" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
        </svg>`;
    }

    return `<svg viewBox="0 0 64 64">
      <circle class="sun-core" cx="32" cy="32" r="12"/>
      <g class="sun-rays">
        <line x1="32" y1="8" x2="32" y2="0"/>
        <line x1="32" y1="64" x2="32" y2="56"/>
        <line x1="8" y1="32" x2="0" y2="32"/>
        <line x1="64" y1="32" x2="56" y2="32"/>
        <line x1="12" y1="12" x2="6" y2="6"/>
        <line x1="52" y1="52" x2="58" y2="58"/>
        <line x1="12" y1="52" x2="6" y2="58"/>
        <line x1="52" y1="12" x2="58" y2="6"/>
      </g>
    </svg>`;
}

function weatherName(code) {
    const map = {
        0: "Clear", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Cloudy",
        45: "Fog", 48: "Mist",
        51: "Drizzle", 53: "Drizzle", 55: "Drizzle",
        61: "Rain", 63: "Rain", 65: "Heavy Rain",
        71: "Snow", 73: "Snow", 75: "Heavy Snow",
        95: "Thunderstorm", 96: "Thunderstorm", 99: "Thunderstorm"
    };
    return map[code] || "Weather";
}

function miniIcon(code) {
    if (code === 0) return "â˜€ï¸";
    if ([1,2].includes(code)) return "ðŸŒ¤ï¸";
    if (code === 3) return "â˜ï¸";
    if ([45,48].includes(code)) return "ðŸŒ«ï¸";
    if ([51,53,55,61,63,65].includes(code)) return "ðŸŒ§ï¸";
    if ([71,73,75].includes(code)) return "â„ï¸";
    if ([95,96,99].includes(code)) return "â›ˆï¸";
    return "â˜€ï¸";
}

async function loadWeatherAndForecast() {
    try {
const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&temperature_unit=fahrenheit&timezone=auto`;


        const res = await fetch(url);
        const data = await res.json();

        /* ---- CURRENT ---- */
        document.getElementById("weatherTemp").innerText =
            Math.round(data.current_weather.temperature) + "Â°F";

        const desc = weatherName(data.current_weather.weathercode);
        document.getElementById("weatherDesc").innerText = desc;
        document.getElementById("weatherIcon").innerHTML = iconSvg(desc);

        /* ---- FORECAST ---- */
        const rows = data.daily.time.slice(1,6).map((d,i)=>{
            return `
              <div class="forecast-row">
                  <span class="forecast-day">
                      ${new Date(d).toLocaleDateString("en-US",{weekday:"short"})}
                  </span>
                  <span class="mini-icon">${miniIcon(data.daily.weathercode[i+1])}</span>
                  <span class="forecast-temp">
                      ${Math.round(data.daily.temperature_2m_max[i+1])}Â° /
                      ${Math.round(data.daily.temperature_2m_min[i+1])}Â°
                  </span>
              </div>`;
        }).join("");

        const container = document.getElementById("forecastRows");
container.classList.remove("show");
container.innerHTML = rows;
setTimeout(() => container.classList.add("show"), 50);



    } catch (err) {
        console.log("Weather error:", err);
        document.getElementById("forecastRows").innerHTML =
            `<div class="forecast-row"><span>No forecast</span></div>`;
    }
}
loadWeatherAndForecast();
setInterval(loadWeatherAndForecast, 600000);

/* ========================================================= */
/* AUTO-REFRESH TRANSIT */
/* ========================================================= */
setInterval(() => bus.contentWindow.location.reload(), 60000);
setInterval(() => path.contentWindow.location.reload(), 120000);
setInterval(() => lrt.contentWindow.location.reload(), 300000);
</script>

</body>
</html>
